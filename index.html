# Checking the installation of CrowdStrike
Add-Type -AssemblyName "System.Windows.Forms"

$folderPath = "C:\Windows\System32\drivers\CrowdStrike"
if (-not (Test-Path $folderPath)) {
    [System.Windows.Forms.MessageBox]::Show("WARNING: It looks like CrowdStrike is not installed. Please check manually from the Control Panel.", "Folder Not Found")
}

# Checking if bitlocker enabled
Add-Type -AssemblyName "System.Windows.Forms"

# Specify the drive letter to check (e.g., C: drive)
$driveLetter = "C:"

# Get BitLocker status for the specified drive
$bitlockerStatus = Get-BitLockerVolume -MountPoint $driveLetter

# Check if BitLocker is not enabled
if ($bitlockerStatus.ProtectionStatus -ne 'On') {
    [System.Windows.Forms.MessageBox]::Show("WARNING: It looks like BitLocker is not enabled. Please check manually from the Control Panel.", "BitLocker Status")
}

# For battery power (after 0 minutes):
powercfg /change monitor-timeout-dc 0

# For plugged in (after 0 minutes)
powercfg /change monitor-timeout-ac 0

# For battery power (after 0 minutes)
powercfg /change standby-timeout-dc 0

# For plugged in (after 0 minutes)
powercfg /change standby-timeout-ac 0

# Change to Downloads directory
cd $env:USERPROFILE\Downloads

# Remove previous Lenovo_Vantage folder if it exists
Remove-Item -Recurse -Force -ErrorAction SilentlyContinue Lenovo_Vantage

# Download Lenovo_Vantage in the background
$downloadProcess = Start-Process "curl" -ArgumentList "-o", "Lenovo_Vantage.zip", "https://download.lenovo.com/pccbbs/thinkvantage_en/metroapps/Vantage/LenovoCommercialVantage_20.2506.39.0_v17.zip" -PassThru

# Wait for the download to finish
$downloadProcess.WaitForExit()

# Extract the zip only after the download is complete
Expand-Archive -Path "Lenovo_Vantage.zip" -DestinationPath "Lenovo_Vantage"

# Run the setup after extraction is done
Start-Process -FilePath "Lenovo_Vantage\VantageInstaller.exe" -ArgumentList "Install -Vantage" -Wait

###### Launch Lenovo_Vantage CommercialVantage.exe when finish install
# Get the package information for LenovoSettingsforEnterprise
$appPackage = Get-AppxPackage -Name *LenovoSettingsforEnterprise*

# Extract the InstallLocation and build the path to the .exe
$installLocation = $appPackage.InstallLocation
$exePath = Join-Path -Path $installLocation -ChildPath "LenovoVantage\CommercialVantage.exe"

# Check if the .exe exists and launch it
if (Test-Path $exePath) {
    Start-Process $exePath
} else {
    Write-Host "The specified .exe was not found: $exePath"
}


##########
