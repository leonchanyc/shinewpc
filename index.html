# For battery power (after 0 minutes):
powercfg /change monitor-timeout-dc 0

# For plugged in (after 0 minutes)
powercfg /change monitor-timeout-ac 0

# For battery power (after 0 minutes)
powercfg /change standby-timeout-dc 0

# For plugged in (after 0 minutes)
powercfg /change standby-timeout-ac 0

# Change to Downloads directory
cd $env:USERPROFILE\Downloads

# Remove previous Lenovo_Vantage folder if it exists
Remove-Item -Recurse -Force -ErrorAction SilentlyContinue Lenovo_Vantage

# Download Lenovo_Vantage in the background (old, link to lenovo site)
# $downloadProcess = Start-Process "curl" -ArgumentList "-o", "Lenovo_Vantage.zip", "https://download.lenovo.com/pccbbs/thinkvantage_en/metroapps/Vantage/LenovoCommercialVantage_20.2506.39.0_v17.zip" -PassThru

# Download Lenovo_Vantage in the background (new, craft mirror)
$downloadProcess = Start-Process "curl" -ArgumentList "-o", "Lenovo_Vantage.zip", "https://secure-res.craft.do/v2/5NdAiybBRwoNGKXQ65qpH6AfbJS7PHYQNrn3KjWHiS62oSVrWoJ7jMt3y7yYGdVUJLfQ7cWoscJZFGsPvELLN8SQX6AKeCQh6M1eZx4nKGgSv4nKUfY8aa8peZyT5Q4E1EEsH6NCxCCedUTsknv9JHqaWzVMMfnSJ8SfetKcL6HGm1nRWMFMr79U7TtxPnd155VGt1oQQpdDfdiDB1nWCQDH9Ju/LenovoCommercialVantage_20.2506.39.0_v17.zip" -PassThru

# Wait for the download to finish
$downloadProcess.WaitForExit()

# Extract the zip only after the download is complete
Expand-Archive -Path "Lenovo_Vantage.zip" -DestinationPath "Lenovo_Vantage"

# Run the setup after extraction is done
Start-Process -FilePath "Lenovo_Vantage\VantageInstaller.exe" -ArgumentList "Install -Vantage" -Wait

###### Launch Lenovo_Vantage CommercialVantage.exe when finish install
# Get the package information for LenovoSettingsforEnterprise
$appPackage = Get-AppxPackage -Name *LenovoSettingsforEnterprise*

# Extract the InstallLocation and build the path to the .exe
$installLocation = $appPackage.InstallLocation
$exePath = Join-Path -Path $installLocation -ChildPath "LenovoVantage\CommercialVantage.exe"

# Check if the .exe exists and launch it
if (Test-Path $exePath) {
    Start-Process $exePath
} else {
    Write-Host "The specified .exe was not found: $exePath"
}


##########
